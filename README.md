# すにゃbot
**スニャイヴがjavascriptで~~遊ぶため~~勉強するために生み出されたDiscordのBotです。**\
Twitter(自称X)アカウント：[@Snyiv495](https://x.com/Snyiv495)

## 目次

- [はじめに](#はじめに)
- [実装機能1](#読み上げ機能) : 読み上げ機能
- [実装機能2](#AI機能) : AI機能
- [実装機能3](#コラ作成機能) : コラ作成機能
- [実装機能4](#おみくじ機能) : おみくじ機能
- [実装機能5](#FAQ機能) : FAQ機能
- [実装機能6](#その他) : その他
- [おわりに](#おわりに)

## はじめに

### サーバーへの招待
> [!IMPORTANT]
> **すにゃbot**はメッセージへの反応や返信、ボイスチャンネルに接続して読み上げをする機能などが搭載されています。\
> 招待する際にはこれらの権限を切らないでください。

### 利用方法
**すにゃbot**を利用する手段として、大きく以下の2つの方法を用意しています。

1. スラッシュコマンド\
    チャットにスラッシュコマンドを入力することで、**すにゃbot**を利用することができます。\
    ある程度コマンドを覚えておく必要はありますが、任意の機能に素早くアクセスできます。

2. メニュー選択\
    チャットから**すにゃbot**をメンションすることで、メニュー選択形式で**すにゃbot**を利用することができます。\
    任意の機能へたどり着くまでに多少の手数が必要となりますが、利用したい機能を直感的に選ぶことができます。

> [!TIP]
> 完璧にコマンドを覚えていなくても、`/`を入力した段階で、コマンド一覧が表示されます。\
> さらに、そこから**すにゃbot**のアイコンを選択すれば、**すにゃbot**限定のコマンド一覧が表示されます。

## 読み上げ機能
チャットに送信されたメッセージを読み上げる機能が搭載されています。\
音声合成には[VOICEVOX](https://voicevox.hiroshiba.jp/)を利用しています。

- [機能詳細1](#読み上げの開始) : 読み上げの開始
- [機能詳細2](#読み上げの終了) : 読み上げの終了
- [機能詳細3](#辞書の登録) : 辞書の登録
- [機能詳細4](#辞書の削除) : 辞書の削除
- [機能詳細5](#ユーザー設定) : ユーザー設定
- [機能詳細6](#サーバー設定) : サーバー設定

### 読み上げの開始
読み上げを行いたいテキストチャンネル上で起動することで、読み上げを開始します。\
この際、任意のボイスチャンネルに接続している必要があります。\
また、すでに読み上げを行っている状態で、他に読み上げを行いたいテキストチャンネル上で起動することで、複数チャンネルの読み上げを行います

1. スラッシュコマンドによる起動\
    `/read _start`

2. メニュー選択による起動
    ```
    1. すにゃbotをメンション
    2. [開始]ボタンを押下
    3. [読み上げ]メニューを押下
    4. [読み上げ開始]メニューを押下
    ```

> [!NOTE]
> 読み上げを開始できない場合は以下の要因が考えられます
> - DMなど、テキストチャンネル以外で起動しようとしている
> - テキストチャンネルのメンバーにすにゃbotが入っていない
> - プライベートチャンネルであるなど、すにゃbotがそのチャンネルを見ることができない
> - ボイスチャンネルに接続せずに起動しようとしている
> - すにゃbotにボイスチャンネルに接続する権限や喋る権限が与えられていない
> - ボイスチャンネルに接続できる上限の人数を満たしている
> - すでに読み上げを行っている


### 読み上げの終了
読み上げを行っているテキストチャンネル上で起動することで、読み上げを終了します。\
この際、読み上げを行っているボイスチャンネルに接続している必要があります。\
また、読み上げを行っているボイスチャンネルからユーザーがいなくなった場合、自動的に読み上げを終了します

1. スラッシュコマンドによる起動\
    `/read _end`

2. メニュー選択による起動
    ```
    1. すにゃbotをメンション
    2. [開始]ボタンを押下
    3. [読み上げ]メニューを押下
    4. [読み上げ終了]メニューを押下
    ```


### 辞書の登録
テキストチャンネル上で起動することで、読み上げ方の辞書を登録することができます。

1. スラッシュコマンドによる起動\
    `/read _dict_add`

    `/read _dict_add word:hogehoge kana:ホゲホゲ`\
    *word*および*kana*オプションは必須になります。
    - word : 登録する語句
    - kana : 登録する語句の読み方

    `/read _dict_add word:hogehoge kana:ホゲホゲ accent:1 priority:5`\
    *accent*および*priority*オプションを任意で指定できます。
    - accent : アクセントの位置
    - priority : 登録する読み方の優先度 

    指定しない場合、アクセントは1文字目、優先度は9として辞書登録が行われます。

2. メニュー選択による起動
    ```
    1. すにゃbotをメンション
    2. [開始]ボタンを押下
    3. [読み上げ]メニューを押下
    4. [辞書追加]メニューを押下
    5. 入力フォームに、読み上げ方を指定したい語句を入力（必須）
    6. 入力フォームに、語句の読み方を入力（必須）
    7. 入力フォームに、読み方における何文字目がアクセント位置になるかを入力（任意）
    8. 入力フォームに、その読み方を行う優先度合いを入力（任意）
    9. [送信]ボタンを押下
    ```


### 辞書の削除
テキストチャンネル上で起動することで、読み上げ方の辞書を削除することができます。

1. スラッシュコマンドによる起動\
    `/read _dict_del`\
    オプションを指定しない場合、辞書一覧のファイルが送信されます。

    `/read _dict_del word:hogehoge`\
    *word*オプションを指定することで、辞書を削除できます。

2. メニュー選択による起動
    ```
    1. すにゃbotをメンション
    2. [開始]ボタンを押下
    3. [読み上げ]メニューを押下
    4. [辞書削除]メニューを押下
    5. 入力フォームに、読み上げ方を削除したい語句を入力（任意）
    6. [送信]ボタンを押下
    ```

### ユーザー設定
読み上げ方に関して、ユーザーごとの設定をすることができます。

#### スピーカー&スタイル設定
テキストチャンネル上で起動することで、読み上げるスピーカーとそのスタイルを設定できます。

1. スラッシュコマンドによる起動\
    `/read _set_user`\
    オプションを指定しない場合、変更は行われません。

    `/read _set_user speaker:春日部つむぎ`\
    *speaker*オプションを指定することができます。\
    この場合、スタイルはデフォルトのものが選ばれます。

    `/read _set_user style:ノーマル`\
    *style*オプションを指定することができます。\
    この場合、現在設定されているスピーカーのスタイルのみ指定できます。

    `/read _set_user speaker:春日部つむぎ style:ノーマル`\
    *speaker*および*style*オプションを指定することができます。\
    この場合、任意のスピーカーにおける任意のスタイルを指定できます。

    `/read _set_user speaker:ランダム style:ランダム`\
    *speaker*および*style*オプションには「ランダム」を指定することもできます。

2. メニュー選択による起動
    ```
    1. すにゃbotをメンション
    2. [開始]ボタンを押下
    3. [読み上げ]メニューを押下
    4. [ユーザー設定]メニューを押下
    5. [スピーカー設定]あるいは[スタイル設定]メニューを押下
    6. 設定したいスピーカーあるいはスタイルのメニューを押下
    7. [決定]メニューを押下
    ```

#### パラメーター設定
テキストチャンネル上で起動することで、読み上げのパラメータを設定ができます。

1. スラッシュコマンドによる起動\
    `/read _set_user`\
    オプションを指定しない場合、変更は行われません。

    `/read _set_user pitch:0.1`\
    *pitch*オプションを指定することができます。\
    読み上げる声の高さを設定できます。

    `/read _set_user intonation:1.25`\
    *intonation*オプションを指定することができます。\
    読み上げる声の抑揚を設定できます。

    `/read _set_user username:ホゲホゲ`\
    *username*オプションを指定することができます。\
    自分の名前の読み方を設定できます。

    `/read _set_user pitch:0.1 intonation:1.25 username:ホゲホゲ`\
    全てのオプションを同時に指定することもできます。

2. メニュー選択による起動
    ```
    1. すにゃbotをメンション
    2. [開始]ボタンを押下
    3. [読み上げ]メニューを押下
    4. [ユーザー設定]メニューを押下
    5. [パラメーター設定]メニューを押下
    6. 入力フォームに、変更したいパラメータを入力
    7. [決定]メニューを押下
    ```

### サーバー設定
読み上げ方に関して、サーバー全体の設定をすることができます。

#### スピーカー&スタイル設定
テキストチャンネル上で起動することで、読み上げるスピーカーとそのスタイルを設定できます。

1. スラッシュコマンドによる起動\
    `/read _set_server`\
    オプションを指定しない場合、変更は行われません。

    `/read _set_server speaker:春日部つむぎ`\
    *speaker*オプションを指定することができます。\
    この場合、スタイルはデフォルトのものが選ばれます。

    `/read _set_server style:ノーマル`\
    *style*オプションを指定することができます。\
    この場合、現在設定されているスピーカーのスタイルのみ指定できます。

    `/read _set_server speaker:春日部つむぎ style:ノーマル`\
    *speaker*および*style*オプションを指定することができます。\
    この場合、任意のスピーカーにおける任意のスタイルを指定できます。

    `/read _set_server speaker:ランダム style:ランダム`\
    *speaker*および*style*オプションには「ランダム」を指定することもできます。

2. メニュー選択による起動
    ```
    1. すにゃbotをメンション
    2. [開始]ボタンを押下
    3. [読み上げ]メニューを押下
    4. [サーバー設定]メニューを押下
    5. [スピーカー設定]あるいは[スタイル設定]メニューを押下
    6. 設定したいスピーカーあるいはスタイルのメニューを押下
    7. [決定]メニューを押下
    ```

#### パラメーター設定
テキストチャンネル上で起動することで、読み上げのパラメータを設定ができます。

1. スラッシュコマンドによる起動\
    `/read _set_server`\
    オプションを指定しない場合、変更は行われません。

    `/read _set_server speed:1.5`\
    *speed*オプションを指定することができます。\
    読み上げる声の速度を設定できます。

    `/read _set_server pitch:0.1`\
    *pitch*オプションを指定することができます。\
    読み上げる声の高さを設定できます。

    `/read _set_server intonation:1.25`\
    *intonation*オプションを指定することができます。\
    読み上げる声の抑揚を設定できます。

    `/read _set_server volume:0.5`\
    *volume*オプションを指定することができます。\
    読み上げる声の大きさを設定できます。

    `/read _set_server speed:1.5 pitch:0.1 intonation:1.25 volume:0.5`\
    全てのオプションを同時に指定することもできます。

2. メニュー選択による起動
    ```
    1. すにゃbotをメンション
    2. [開始]ボタンを押下
    3. [読み上げ]メニューを押下
    4. [サーバー設定]メニューを押下
    5. [パラメータ設定]メニューを押下
    6. 入力フォームに、変更したいパラメータを入力
    7. [決定]メニューを押下
    ```

#### 詳細設定
テキストチャンネル上で起動することで、読み上げの詳細設定ができます。

1. スラッシュコマンドによる起動\
    `/read _set_server`\
    オプションを指定しない場合、変更は行われません。

    `/read _set_server read_username:True`\
    *read_username*オプションを指定することができます。\
    チャット送信者の名前を読み上げるかを設定できます。

    `/read _set_server read_username_always:False`\
    *read_username_always*オプションを指定することができます。\
    チャット送信者が前回と同じ場合に名前を読み上げるかを設定できます。

    `/read _set_server read_max:50`\
    *read_max*オプションを指定することができます。\
    1回のチャットに対して最大何文字読み上げるかを設定できます。

    `/read _set_server read_app:VOICEVOX`\
    *read_app*オプションを指定することができます。\
    利用する合成音声ソフトを変更~~できます~~できるようにしたいです。

    `/read _set_server read_set_override:False`\
    *read_set_override*オプションを指定することができます。\
    読み上げる声の設定をサーバー設定で設定したものに上書きします。

    `/read _set_server read_username:True read_username_always:False read_max:50 read_app:VOICEVOX　read_set_override:False`\
    全てのオプションを同時に指定することもできます。

2. メニュー選択による起動
    ```
    1. すにゃbotをメンション
    2. [開始]ボタンを押下
    3. [読み上げ]メニューを押下
    4. [サーバー設定]メニューを押下
    5. [詳細設定]メニューを押下
    6. 入力フォームに、変更したい内容を入力
    7. [決定]メニューを押下
    ```

## AI機能
春日部つむぎ風の出力をしてくれるAI機能が搭載されています。\
生成には[gemini AI](https://gemini.google/about/?hl=ja)を利用しています。

- [機能詳細1](#チャット出力) : チャット出力
- [機能詳細2](#イラスト出力) : イラスト出力
- [機能詳細3](#呼びかけ) : 呼びかけ

### チャット出力
テキストチャンネル上で起動することで、AIとチャットを行えます。\
このREADMEの情報を持っているため、**すにゃbot**の使い方に関する質問には基本的に答えてくれます。\
また会話履歴は最大で直近10件まで保存しているため、それを踏まえた出力もできます。

1. スラッシュコマンドによる起動\
    `/ai _chat_private`

    `/ai _chat_private request:読み上げはどうやって始めるの？`\
    *request*オプションは必須になります。
    - request : チャット内容

2. メニュー選択による起動
    ```
    1. すにゃbotをメンション
    2. [開始]ボタンを押下
    3. [AI]メニューを押下
    4. [AIチャット]メニューを押下
    5. 入力フォームに、チャット内容を入力
    6. [決定]メニューを押下
    ```

### イラスト出力
Please wait for update...

### 呼びかけ
テキストチャンネル上でbotに呼びかけるメッセージを送信すると回答してくれます。\
送信したチャンネルの過去20件のメッセージを確認しているため、それを踏まえた出力もできます。\
~~geminiが悪いのか知らないけど、似通った質問を連投すると同じ返答を連投してきます。助けて~~

- 呼びかけ方法\
    `すにゃbotは今起動してる？`\
    メッセージ内容に名指しが確認できれば反応してくれます。\
    `おやすみすなぼ`\
    このレベルまでの簡略化であれば名指しと判定します。

- 機能呼び出し\
    `すにゃbot 読み上げを開始して`\
    読み上げの開始や終了を要求すると、AIの判断によって読み上げ機能を実行してくれます。\
    `すにゃbot hogehogeをホゲホゲで辞書に追加して`\
    辞書の追加や削除を要求すると、AIの判断によって簡易的に行ってくれます。\
    `今日のおみくじを引いてすなぼ`\
    おみくじの要求もできます。

## コラ作成機能
テキストチャンネルに送信されたメッセージにリアクションを付与することで、そのメッセージ内容を画像上に書いたコラ画像を作成できます。\
現在実装しているリアクションは以下になります。
```
🤓🤖🦈💭🗯️💬🗨️
```

## おみくじ機能
テキストチャンネル上で起動することで、1日1回のおみくじを引くことができます。\
生成には[gemini AI](https://gemini.google/about/?hl=ja)を利用しています。

1. スラッシュコマンドによる起動\
    `/omikuji _draw`

2. メニュー選択による起動
    ```
    1. すにゃbotをメンション
    2. [開始]ボタンを押下
    3. [おみくじ]メニューを押下
    4. [引く]メニューを押下
    ```

## FAQ機能
一問一答形式のFAQを確認できる機能が搭載されています。\
~~このREADMEを読んでいる方にはなんの役にも立ちません~~\
テキストチャンネル上で起動することで、**すにゃbot**の使い方について簡単な回答を表示します。

1. スラッシュコマンドによる起動\
    `/qna _ai`\
    ずんだもんAI機能のFAQメニューが表示されます。\
    下記の[2. メニュー選択による起動]の[5.]以降の操作を行ってください。

    `/qna _omikuji`\
    おみくじ機能のFAQメニューが表示されます。\
    下記の[2. メニュー選択による起動]の[5.]以降の操作を行ってください。

    `/qna _read`\
    読み上げ機能のFAQメニューが表示されます。\
    下記の[2. メニュー選択による起動]の[5.]以降の操作を行ってください。

2. メニュー選択による起動
    ```
    1. すにゃbotをメンション
    2. [開始]ボタンを押下
    3. [FAQ]メニューを押下
    4. 知りたい機能のメニューを押下
    5. 知りたい内容のメニューを押下
    ```

## その他
すにゃbotのメッセージに「✂️」または「🗑️」のリアクションをつけると、そのメッセージの削除を行います。
メッセージを削除する権限を持っていない人がすにゃbotのメッセージを削除できるようにつけてみました。

## おわりに
### 謝辞
今回の開発においてご助力いただいた~~一方的に利用させていただいた~~みなさまに心から感謝申し上げます。
- ヒホ(ヒロシバ)様([Twitter](https://x.com/hiho_karuta?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor), [github](https://github.com/Hiroshiba))
- VOICEVOX開発者の皆様([github](https://github.com/VOICEVOX/voicevox_engine))
- Technical Bot様([YouTube](https://www.youtube.com/c/technicalbot))

## TODO

- [ ] AIのファイル入力
- [ ] AIのイラスト出力機能

- [x] 謝辞をまとめる

- [x] リアクション関連の実装
- [ ] スラッシュコマンドの整理